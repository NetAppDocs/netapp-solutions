---
sidebar: sidebar
permalink: containers/rh-os-n_use_case_openshift_virtualization_dataprotection_backup.html
keywords: OpenShift, OCP, Astra Trident, NetApp ONTAP, Red Hat OpenShift, OpenShift Virtualization, CNV, Container Native Virtualization, Red Hat OpenShift Virtualization, OADP operator, Openshift Data Protection Application operator, velero
summary: Red Hat OpenShift Virtualization with NetApp ONTAP
---

= Creating Backup for VMs in OpenShift virtualization 
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./../media/

== Steps to create a backup of a VM

To create an on-demand backup of the entire VM (VM metadata and VM disks), click on the **Backup** tab.
You can use the following yaml. Here the VM and its disks in the specified namespace will be backed up. 
A snapshot of the persistent volumes backing the disks will be created by the CSI and will be moved to the object storage location provided in the yaml. 
The backup will remain in the system for 30 days as specified in the ttl.

....
apiVersion: velero.io/v1
kind: Backup
metadata:
  name: backup1
  namespace: openshift-adp
spec: 
  includedNamespaces:
  - virtual-machines-demo
  snapshotVolumes: true
  storageLocation: velero-demo-1
  ttl: 720h0m0s
....


Once the backup completes, its Phase should show as completed.

image::redhat_openshift_OADP_backup_image1.jpg[Backup completed]

You can inspect the backup in the Object storage with the help of an S3 browser application.
The path of the backup shows in the configured bucket with the prefix name (velero/demobackup). 
You can see the contents contain the volume snapshots logs and other metadata of the virtual machine. 

image::redhat_openshift_OADP_backup_image2.jpg[Backup Objects in S3]

== Creating a schedule for the backups

To create a backup on a schedule, you need to create a Schedule CR. 
The schedule is simply a Cron expression allowing you to specify the time at which you want to create the backup.

....
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: <schedule>
  namespace: openshift-adp
spec:
  schedule: 0 7 * * * 
  template:
    hooks: {}
    includedNamespaces:
    - <namespace> 
    storageLocation: <velero-sample-1> 
    defaultVolumesToFsBackup: true 
    ttl: 720h0m0s
....

The Cron expression 0 7  * * * means a backup will be created at 7:00 every day.
What should be included in the backup and the storage locations are also specified. So instead of a Backup CR, Schedule CR is used to create a backup ar the specified time and frequency.

Once the schedule is created, it will be Enabled.

image::redhat_openshift_OADP_backup_image3.jpg[Schedule created]





  