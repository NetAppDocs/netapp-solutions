---
sidebar: sidebar
permalink: containers/devops_with_netapp/dwn_use_case_flexclone.html
keywords: OpenShift, Kubernetes, Astra Control, Astra Trident, NetApp ONTAP, Cloning, FlexClones, Jenkins, Application
summary: Using FlexClone technology to rapidly deploy
---

= Accelerating Software Development with NetApp FlexClones

:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./../../media/

== Overview

Being able to clone a deployed application in a Kubernetes cluster is a very useful tool for developers that would like to expedite their workflows by ensuring that they can share like environment with partners, or test new versions of code in a development environment without affecting the version they are currently working on. The stateful and application-consistent cloning of a Kubernetes application is one major feature included with NetApp Astra Control alongside backup and restore of applications. A bonus to this, is that if an application is cloned within the same Kubernetes cluster, and using the same storage backend, Astra Control defaults to using NetApp FlexClone technology for duplicating the persistent data volumes, speeding up the entire process tremendously. By accelerating this process, the cloned environment is provisioned and available for use in a few moments, allowing developers to resume their work with just a brief pause when compared to having to redeploy their test or development environment. Itâ€™s also an additional convenience that all of the functions available in NetApp Astra Control can be called via an API which allows for easy integration into automation frameworks like Ansible and can result environments being staged even more rapidly since only minor changes need to be made to a playbook or role to begin the cloning procedure.

== What is a NetApp FlexClone?

NetApp FlexClone technology is a writeable, point-in-time snapshot based copy of a NetApp FlexVol. They are provisioned almost instantly and contain all of the data previously existing in the source volume, and they consume no additional storage space until the data in the new volume begins to diverge from the source. They are often used in development or template based environments when multiple copies of data come in very handy for staging purposes, and storage systems have limited resources in order to provision those volumes. Compared to a traditional storage system where data would have to be copied multiple times over resulting in additional consumption of space, in additional to the time needed to complete the copies, NetApp FlexClones can be quite beneficial to those looking to accelerate their storage dependant tasks.

image::Astra-DevOps-UC3-FlexClone.png[FlexClone Image]

To find out more about NetApp FlexClone Technology, visit the page on https://docs.netapp.com/us-en/ontap/concepts/flexclone-volumes-files-luns-concept.html[NetApp Docs].

== Pre-requisites

.	A supported Kubernetes Distribution: Red Hat OpenShift 4.6.8+, Rancher 2.5+, Kubernetes 1.19+.
.	NetApp Astra Control Center 21.12+.
.	A NetApp ONTAP system with a storage backend configured through NetApp Astra Trident.
. Ansible 2.9+.
. Templates for the environments that you'd like to clone as managed applications in NetApp Astra Control.

== Use-case Introduction

For this use case we visualize something similar to the following workflow:

image::Astra-DevOps-UC3-Workflow.png[Workflow Image]

. A user runs the ansible playbook to create a new staging environment.
. Ansible uses the URI-API module to call out to Astra Control to execute the cloning operation.
. Astra Control executes a cloning operation on a pre-provisioned template environment creating a new managed application.
+
NOTE: This environment can be a single standalone application in development, or an entire development environment like a Jenkins CI/CD pipeline.

. The user then pulls a version of their code into the cloned dev environment from an online repository like Gitea.
. The new version of the application is deployed and managed by NetApp Astra Control.
+
NOTE: Both of these processes can be automated as well.

. The user can working on developing new code in this cloned environment.
. Satisfied with their development efforts, the user can push the code back to their hosted repository.

The use case being presented is dependent on the existence of golden templates for the particular environments or applications you would like to clone. In our environment we have created three such templates, one for a Wordpress deployment, one for a Magento deployment, and one for a Jenkins CI/CD environment with Gitea that we have titled DevTools.

image::Astra-DevOps-UC3-Templates.png[Templates Image]

Each of these environments is managed by NetApp Astra control, with persistent volumes currently stored on a NetApp ONTAP storage system with an NFS backend provided by NetApp Astra Trident.

== Use-case Validation

. Clone the ansible toolkit provided by the NetApp Solutions Engineering team which includes the cloning role, and the application update playbook.
+
----
[netapp-user@rhel7 ~]$ git clone https://github.com/NetApp-Automation/na_astra_control_suite.git
[netapp-user@rhel7 ~]$ cd na_astra_control_suite
----


. Edit the vars/clone_vars.yml, and fill in the global values that fit your Astra Control environment.
+
----
astra_control_fqdn: astra-control-center.example.com
astra_control_account_id: "xxxx-xxxx-xxxx-xxxx-xxxx"
astra_control_api_token: "xxxxx"
----
+
NOTE: The global environment values you need to fill out are all available under the user profile icon in NetApp Astra Control under the API Access menu.

+
image::Astra-DevOps-UC3-APIAccess.png[API Access Image]


. With the global variables filled out, you can choose the values for the specific application you wish to clone. To clone the devtools environment to a personal environment called alan-devtools, you would do the following:
+

----
clone_details:
  - clone_name: alan-devtools
    destination_namespace: alan-dev-namespace
    source_cluster_name: ocp-vmware2
    destination_cluster_name: ocp-vmware2
    source_application_name: devtools-template
----
+
NOTE: To take advantage of NetApp FlexClone technology in the cloning process, src-cluster and dest-cluster must be the same.


. You can now execute the playbook to clone the application.
+

----
[netapp-user@rhel7 na_astra_control_suite]$ ansible-playbook -K clone_app_playbook.yml]
----
+
NOTE: The playbook as written must be run by the root user, or someone that can escalate through the sudo process by passing the "-K" argument.

. When the playbook completes it's run, the cloned application will show as available in the Astra Control Center console.
+
image::Astra-DevOps-UC3-ClonedApp.png[Cloned App Image]

. A user can then login to the Kubernetes environment where the application was deployed, ensure that the application is exposed with a new IP address, and start their development work.


For a demonstration of this use case, as well as a sample of upgrading an application, please visit the page link:dwn_videos_astra_control_flexclone.html[here^].

link:dwn_videos_and_demos.html[Next: Videos and Demos - DevOps with NetApp Astra]
