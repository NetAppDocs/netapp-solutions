---
sidebar: sidebar
permalink: databases/azure_ora_nfile_procedures.html
summary: This section describes the deployment procedures of deploying Oracle RDS custom database with FSx storage.
keywords: AWS, Oracle, RDS, HA, DR, database
---

= Step-by-Step Oracle Deployment Procedures on Azure VM and Azure NetApp Files (ANF)
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:table-stripes: odd
:imagesdir: ./../media/

link:azure_ora_nfile_factors.html[Previous: Factors to consider.]

== Deploy an Azure VM with ANF for Oracle via Azure portal console

If you are new to Azure, you first need to set up an Azure account environment. This includes to sign up your organization to use Azure Active Directory. The following section is a summary of these steps. For details, see the linked Azure specific documentation.

=== Sign up your organization to use Azure Active Directory

If your organization are already using some of web based Microsoft service like Office 365, you most likely already had signed up for Azure Active Directory. The following Azure documentation provides the necessary details if you have not:

* link:https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/sign-up-organization[Sign up your organization to use Azure Active Directory^]

Key topics:

* Create a directory
* Add a custom domain name
* Associate an Azure subscription

=== Use Azure subscription to scale and manage the environment

Azure charges for the services it offers to organizations. Each organization is given an Azure AD Tenant, can create Azure Accounts, and can create different subscriptions for the use of different services. These terminologies are defined below:

* Organization — Any business entity or individual that plans to use Azure resources. An organization is identified by one or more domain names.

* Tenant — A specific instance of Azure AD, identified and authorized using a Tenant ID. After Azure registration, organizations are given the Azure AD Tenant. Azure AD is a single platform that allows you to manage accounts, users, groups and permissions.

* Accounts — Azure AD Tenant stores all accounts created to utilize Azure’s offerings.

Key points:

* An organization can have many tenants.
* Each tenant can have many subscriptions.
* Each tenant can have many accounts.
* Accounts can use multiple subscriptions.
* Azure AD Tenant determines which account can use which subscription.
* Azure resources must be tied to a subscription for billing purposes.

=== Create and consume Azure resources

After your Azure environment is setup and an account is created and associated to a subscription, you can login to Azure portal with the account to create necessary resources to run Oracle.

==== 1. Create a virtual network or VNet

Azure Virtual Network (VNet) is the fundamental building block for your private network in Azure. VNet enables many types of Azure resources, such as Azure Virtual Machines (VM), to securely communicate with each other, the internet, and on-premises networks. Before Provisioning a Azure virtual machine, a VNet, where VM is deployed into, needs to be configured first.

Follow this documentation link:https://docs.microsoft.com/en-us/azure/virtual-network/quick-create-portal[Create a virtual network using the Azure portal^] to create a VNet.

==== 2. Create a NetApp storage account and a capacity pool for ANF

In this deployment scenario, an Azure VM OS is provisioned using regular Azure storage but ANF volumes are provisioned to run Oracle database via NFS. First, you need to create a NetApp storage account and a capacity pool to host the storage volumes.

Follow this documentation link:https://docs.microsoft.com/en-us/azure/azure-netapp-files/azure-netapp-files-quickstart-set-up-account-create-volumes?tabs=azure-portal[Set up Azure NetApp Files and create an NFS volume^] to setup ANF capacity pool.

==== 3. Provision Azure virtual machine for Oracle

Based on your workload, first determine what type of Azure VM and the size of VM in terms of vCPU and RAM to deploy for Oracle. Then from Azure console, click on Virtual machine icon to launch VM deployment workflow.

. From Azure Virtual machine page, click "Create", then choose Azure virtual machine.
+
image:db_ora_azure_anf_vm_01.PNG[Error: Missing Graphic Image]

. Choose the subscription ID for the deployment, any resource group, region, host name, VM image, size, authentication method. Then, go to "Disk" page.
+
image:db_ora_azure_anf_vm_02-1.PNG[Error: Missing Graphic Image]
image:db_ora_azure_anf_vm_02-2.PNG[Error: Missing Graphic Image]

. Choose premium SSD for OS local redundancy and leave data disk black. the data disks will be mounted from ANF storage instead. Then, go to "Networking page".
+
image:db_ora_azure_anf_vm_03.PNG[Error: Missing Graphic Image]

. Choose VNet and subnet. Allocate a public IP for external VM access. Then, go to "Management page".
+
image:db_ora_azure_anf_vm_04.PNG[Error: Missing Graphic Image]

. Keep all default for Management and move to "Advanced" page.
+
image:db_ora_azure_anf_vm_05.PNG[Error: Missing Graphic Image]

. Keep all default for Advanced page unless you need to customized VM after deployment with custom scripts. Then, go to "Tags" page.
+
image:db_ora_azure_anf_vm_06.PNG[Error: Missing Graphic Image]

. Add a tag for the VM if desired. Then, go to "Review + create" page.
+
image:db_ora_azure_anf_vm_07.PNG[Error: Missing Graphic Image]

. Deployment work flow runs a validation on the configuration, if passed, click on "Create" button to create the VM.
+
image:db_ora_azure_anf_vm_08.PNG[Error: Missing Graphic Image]

==== 4. Provision ANF database volumes for Oracle

You will need to create three NFS volumes off ANF capacity pool for Oracle binary, data, and log volumes respectively.

. From Azure console, under the list of Azure services, click on Azure NetApp Files to open volume creation workflow. If you have more than one ANF storage accounts, click on the account that you intend to provision volumes from.
+
image:db_ora_azure_anf_vols_00.PNG[Error: Missing Graphic Image]

. Under NetApp storage account, click on Volumes, then Add volume to create Oracle volumes.
+
image:db_ora_azure_anf_vols_01_1.PNG[Error: Missing Graphic Image]
image:db_ora_azure_anf_vols_01.PNG[Error: Missing Graphic Image]

. As a good practice, identify Oracle volumes with VM host name as a prefix and follow by mount point on the host such as u01 for Oracle binary, u02 for Oracle data, and u03 for Oracle log. Choose the same VNet for the volume as the VM. Then, click "Next: Protocol>".
+
image:db_ora_azure_anf_vols_02.PNG[Error: Missing Graphic Image]

. Choose NFS protocol, add Oracle host IP address to the allowed client and remove the default policy that allow all IP addresses 0.0.0.0/0. Then, click "Next: Tags>".
+
image:db_ora_azure_anf_vols_03.PNG[Error: Missing Graphic Image]

. Add a volume tag if desired. Then, click "Review + Create>".
+
image:db_ora_azure_anf_vols_04.PNG[Error: Missing Graphic Image]

. If validation passes, click "Create" button to create the volume.
+
image:db_ora_azure_anf_vols_05.PNG[Error: Missing Graphic Image]


== Install and configure Oracle on Azure virtual machine with ANF

NetApp solutions team has built many Ansible based automation tool kits to help you deploy Oracle in Azure smoothly. Follow these steps to deploy Oracle on Azure VM:

. If you have not setup a Ansible controller, go through this documentation link:https://docs.netapp.com/us-en/netapp-solutions/automation/automation_introduction.html[NetApp Solution Automation^], which has detailed instructions on how to setup an Ansible controller.

. Clone a copy of Oracle deployment tool kit in home directory under the user ID that you use to login to Ansible controller.
+
[source, cli]
git clone https://github.com/NetApp-Automation/na_oracle19c_deploy.git

. Follow this instruction link:https://docs.netapp.com/us-en/netapp-solutions/databases/cli_automation.html#cli-deployment-oracle-19c-database[CLI deployment Oracle 19c Database^] to execute the playbook via CLI. You can ignore the ONTAP portion of variables configuration in global VARS file as you create database volumes from Azure console rather than CLI.

[NOTE]

The toolkit default deploys Oracle 19c with RU 19.8. It can be easily adapted for any other patch level with minor default configuration change. Also default seed database active log files are deployed into data volume. If you need active log files on log volume, it should be relocated after initial deployment. Reach out to NetApp Solution team for help if needed.

== Setup backup tool for app consistent snapshot for Oracle

Azure Application Consistent Snapshot tool (AzAcSnap) is a command-line tool that enables data protection for third-party databases by handling all the orchestration required to put them into an application consistent state before taking a storage snapshot, after which it returns them to an operational state.

It is recommended that the tool is installed on the database server host.  
