---
sidebar: sidebar
permalink: databases/aws_postgres_fsx_ec2_hadr.html
keywords: PostgreSQL, AWS, "FSx ONTAP", Database, "Open Source Database"
summary: The solution provides overview and details for PostgreSQL database deployment and HA/DR setup, failover, resync based on NetApp SnapMirror technology built into FSx ONTAP storage offering and NetApp Ansible automation toolkit in AWS.  
---

= PostgreSQL High Availability Deployment and Protection in AWS FSx/EC2
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
// For the imagesdir setting, make sure the path to the media folder is correct.  The default path assumes
// the source is located in the root of the repository.  Select the appropriate setting based on the level
// of the folder containing the source
:imagesdir: ./media/
// :imagesdir: ./../media/
// :imagesdir: ./../../media/


[.lead]
Author(s): Allen Cao,  Niyaz Mohamed,  NetApp

== Purpose
// Describe WHAT problem this solution addresses.  What are the use cases(s) and how does it solve a problem?
// Use a bulleted list and keep it brief!

PostgreSQL is one of widely used open source database. It ranked at number four among the top ten most popular database engines by link:https://db-engines.com/en/ranking[DB-engines racking^]. The PostgreSQL popularity derives from license free model as it is open sourced database engine while not lacking sophisticated features. However, because it is open sourced, there is lacking of documentation on production grade database deployment in the area of high availability and disaster recovery (HA/DR) particularly in public cloud. It can be complicated endeavor trying to setup typical PostgreSQL HA/DR with hot/warm standby, streaming replication etc. It can be difficulty to test the HA/DR environment by promoting standby site, then switch back to primary. There are well documented performance issues on the primary while you maintain a streaming hot standby for read workload.   

This solution is built on well known, proven, popular NetApp SnapMirror storage level replication technology available in AWS native FSX ONTAP cloud storage for PostgreSQL HA/DR. It is simple to implement with automation toolkit provided by NetApp Solutions team. It provides similar PostgreSQL application level HA/DR functionalities while eliminating the complexity, performance drag on the primary site of the application level HA/DR solution. The solution can be easily deployed and tested without any impact to active primary site. Following video demonstrates how the environment is deployed and tested in AWS cloud.  

This solution addresses the following use cases:

* Production grade HA/DR deployment for PostgreSQL in AWS public cloud 
* Test and validate PostgreSQL workload in AWS public cloud
* Developer to stand up a dev/test PostgreSQL environment using DB deployment module

== Audience
// Who is this solution directed at?  DevOps engineer, IT specialist, DB administrator, etc.
// If there are multiple audiences, use a list to identity them.

This solution is intended for the <role> who is interested in <goal>.

OR

This solution is intended for the:

* <role>, who is interested in <goal>,
* <role>, who is interested in <goal>.

== Solution Test / Validation Environment
// Identify the environment in which the solution was tested / validated.

// Things to consider including here are:
// * Architecture diagram
// * Software / hardware and version / release levels or model numbers
// * Specific configuration that might be unique to a lab / test environment

The testing / validation of this solution was performed in a lab that may or may not match the final deployment environment.  For more information, please refer to the following sections.

.Architecture
[%collapsible]
=====
// Insert an image that shows how the solution is architected.

image::image-name.jpg[Solution Architecture Diagram]
=====

.Hardware / Software Components
[%collapsible]
=====
// Identify the hardware and software components along with the appropriate hardware level or software versions
// Use the 3rd column if there is a related link that can be provided for more information

[%autowidth.stretch]
|===
3+^| *Hardware*
| <hardware name> | <model / version> | More Information

3+^| *Software*
| <software name> | <version> | More Information
|===
=====

.Additional Notes
[%collapsible]
=====
// Identify anything that might differ in a production environment that was different in a lab environment or assumptions that were made

* Note 1
* Note 2
...
* Note n
=====

== Solution Deployment
// Describe the steps required to fully deploy the solution.
// Please use collapsible blocks with descriptive titles to condense the content in the published HTML.
// Include screenshots, demo videos, etc. that make the steps as simple and clear as possible.
// DO NOT overdo it with screenshots - where options are "obvious", a screenshot might not be necessary.

The deployment of this solution can be completed:

. Manually by following the detailed instructions complete with screenshots, 
. Manually by following along with videos showing the steps to be executed, or 
. Automatically following the instructions provided in the automation section.

[role="tabbed-block"]
====
.Detailed instructions
--
.Step 1: <descriptive step name>
[%collapsible]
=====
. Task 1
. Task 2
...
. Task n
=====

.Step 2: <descriptive step name>
[%collapsible]
=====
. Task 1
. Task 2
...
. Task n
=====

...

.Step n: <descriptive step name>
[%collapsible]
=====
. Task 1
. Task 2
...
. Task n
=====
--
.Video Walkthrough
--
<Include the video(s) details here>
--
.Automated Deployment
--
<include the automated steps/process/videos here>
--
====

== Other Deployment Options
// Are there other options for deployment (alternate 3rd party software, another way to address the same problem, etc.)?
// If so, BRIEFLY describe them here and point to documentation for more details on those options.

.<Description of Option 1>
[%collapsible]
=====
<enter the details of the option here>
=====

.<Description of Option 2>
[%collapsible]
=====
<enter the details of the option here>
=====

...

.<Description of Option n>
[%collapsible]
=====
<enter the details of the option here>
=====

== Additional Information
// Include references to other documentation (internal or external), videos, demos, blogs, etc. that support the solution.

* link:somewhere.html[Description of the document]
* link:somewhere-else.html[Description of another document]
