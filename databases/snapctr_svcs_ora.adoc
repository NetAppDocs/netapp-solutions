---
sidebar: sidebar
permalink: databases/snapctr_svcs_ora.html
keywords: Oracle, Database, SnapCenter, SnapShot, FlexClone, BlueXP, Database Backup, Database Restore, Database Clone
summary: "The solution provides overview and details for Oracle database backup, restore, clone using NetApp SnapCenter SaaS using BlueXP console." 
---

= TR-XXXX: Oracle Database Backup, Restore and Clone with SnapCenter Services 
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./../media/

Allen Cao, Niyaz Mohamed, NetApp

[.lead]

== Purpose

SnapCenter services is a SaaS version of classic SnapCenter database management UI tool that is available through NetApp BlueXP cloud management console. It is integral part of NetApp Cloud backup and data protection offering for database such as Oracle and HANA running on NetApp cloud storage. This SaaS based service simplifies traditional SnapCenter standalone server deployment that generally requires a Windows server and operates in a Windows domain environment.  

In this documentation, we demonstrate how you can setup SnapCenter services for backup, restore, and clone Oracle databases deployed to AWS FSx ONTAP storage and EC2 compute instances step by step. While much easier to setup and use, it delivers the similar key functionalities as available in legacy SnapCenter UI tool. 

This solution addresses the following use cases:

* Database backup via snapshot for Oracle database hosted in AWS FSx ONTAP
* Oracle database recovery in the case of a failure  
* Fast and storage efficient clone of primary database for DEV/TEST environment or any other use cases  

== Audience

This solution is intended for the following people:

* The DBA, who manages Oracle databases running on AWS FSx ONTAP storage.
* The solution architect, who is interested in testing Oracle database backup, restore, and clone in the public AWS cloud.
* The storage administrator, who supports and manages the AWS FSx ONTAP storage.
* The application owner, who owns applications that are deployed to AWS FSx ONTAP storage 

== Solution test and validation environment

The testing and validation of this solution was performed in an AWS FSx and EC2 environment that might not match the final deployment environment. For more information, see the section <<Key Factors for Deployment Consideration>>.

=== Architecture

image::snapctr_svcs_architecture.png["This image provides a detailed picture of the Cloud Backup for Application within BlueXP console, including the UI, connector and resources it manages."]

The above image provides a detailed picture of the Cloud Backup for Application within BlueXP console, including the UI, connector and resources it manages.

=== Hardware and software components

[%autowidth.stretch]
|===
3+^| *Hardware*
| FSx ONTAP storage | Current version offered by AWS | One FSx HA cluster in the same VPC and availability zone
| EC2 instance for compute | t2.xlarge/4vCPU/16G | Two EC2 T2 xlarge EC2 instances, one as primary DB server and the other as clone DB server 

3+^| *Software*
| RedHat Linux | RHEL-8.6.0_HVM-20220503-x86_64-2-Hourly2-GP2 | Deployed RedHat subscription for testing
| Oracle Grid Infrastructure | Version 19.18 | Applied RU patch p34762026_190000_Linux-x86-64.zip
| Oracle Database | Version 19.18 | Applied RU patch p34765931_190000_Linux-x86-64.zip
| Oracle OPatch | Version 12.2.0.1.36 | Latest patch p6880880_190000_Linux-x86-64.zip
| SnapCenter Service | Version |  v2.3.1.2324
|===

=== Key factors for deployment consideration

* *Connector to be deployed in the same VPC as database and FSx.* When possible the connector should be deployed in the same AWS VPC, which allow connectivity to both FSx storage and EC2 compute instance.

* *An AWS IAM policy created for SnapCenter connector.* The policy in json format is available in detailed SnapCenter service documentation or when you launch connector deployment via BlueXP console, you are prompted for setting up the prerequisites. The policy should be assigned to a AWS user account that owns the connector.

* *AWS account access key and ssh key pair created in AWS account.* The ssh key pair will be assigned to ec2-user for login to connector host, then deploy a database plugin to EC2 DB server host. Access key grants permission for provisioning required connector.   

* *A credential added to BlueXP console setting.* To add FSx ONTAP to BlueXP working environment, a credential that grants permission to access FSx ONTAP from BlueXP console is setup in BlueXP console setting. 

* *SnapCenter plugin deployed to EC2 database instance host.* SnapCenter services make API calls that are executed by SnapCenter plugin on EC2 database instance host. It needs to be deployed before setting up the services.

== Solution Deployment

There are extensive NetApp documentations with a broader scope on protection of your cloud native application data. The goal of this documentation is to provide step by step procedures aided by screen shots that only covers the SnapCenter service deployment via BlueXP console to protect your Oracle database deployed to AWS FSx ONTAP and EC2 compute instance. This document fills in certain details that may be missing from general and overall instructions.

To get started:

* Read the general and overall instructions link:https://docs.netapp.com/us-en/cloud-manager-backup-restore/concept-protect-cloud-app-data-to-cloud.html#architecture[Protect your cloud native applications data^] and the sections related to Oracle and FSx ONTAP.

* Watch the following video walk through.
+
video::oracle-aws-fsx-part4c-bkup-restore-snapctrsvc_callout.mp4[]

=== Prerequisites for SnapCenter service deployment
[%collapsible]

====
Deployment requires the following prerequisites.

. A primary Oracle database server on EC2 instance with an Oracle database fully deployed and running. 

. A FSx ONTAP cluster deployed in AWS that is hosting database above.
. An optional database server on EC2 instance that can be used for testing clone Oracle database to an alternative host for the purpose of supporting DEV/TEST workload or any use cases that requires a full data sets of production Oracle database. 

. If help is needed to meet the above prerequisites for Oracle database deployment on AWS FSx ONTAP and EC2 compute instance refer to this documentation link:aws_ora_fsx_ec2_iscsi_asm.html[Oracle Database Deployment and Protection in AWS FSx/EC2 with iSCSI/ASM^] 

====

=== Onboarding to BlueXP preparation
[%collapsible]

====

. Use this link link:https://console.bluexp.netapp.com/[NetApp BlueXP] to sign up for BlueXP console access.

. For setting up BlueXP to manage AWS cloud resources such as FSx ONTAP, you should already have an AWS account setup and login to your AWS account to create an IAM policy for granting SnapCenter service access to AWS account that will be used for connector deployment.
+
image:snapctr_svcs_connector_01-policy.png[Error: Missing Graphic Image]
+
The policy should configured with JSON string that is available when connector provisioning is launched and you are prompted as a reminder that IAM policy has been created and granted to AWS account that is used for connector deployment. 

. You should also need the AWS VPC, AWS account access key/secrets, ssh key for EC2 access, and security group etc. ready for connector provisioning. 

====

=== Deploy a connector for SnapCenter services
[%collapsible]

====
. Login to BlueXP console, for a shared account, it is a good practice to create a individual workspace by click on Account-Manage Account-Workspace to add a new workspace
+ 
image:snapctr_svcs_connector_02-wspace.png[Error: Missing Graphic Image]

. Click on Add Connector to launch connector provisioning workflow.
+
image:snapctr_svcs_connector_03-add.png[Error: Missing Graphic Image]

. Choose your cloud provider, which is Amazon Web Service.
+
image:snapctr_svcs_connector_04-aws.png[Error: Missing Graphic Image]

. Skip Permission, Authentication, Networking reminder if you already have them setup in AWS account. If not, it is time to configure those requirements before proceeding. From here, you could also retrieve the permissions for AWS policy that is referenced in previous on boarding preparation section. 
+
image:snapctr_svcs_connector_05-remind.png[Error: Missing Graphic Image]

. Enter your AWS account authentication access key and secret key.
+
image:snapctr_svcs_connector_06-auth.png[Error: Missing Graphic Image]

. Name the connector instance, select "Create Role" in Details
+
image:snapctr_svcs_connector_07-details.png[Error: Missing Graphic Image]

. Configure the networking with proper VPC, subnet, and ssh key pair for EC2 access.
+
image:snapctr_svcs_connector_08-network.png[Error: Missing Graphic Image]

. Set the security group for the connector
+
image:snapctr_svcs_connector_09-security.png[Error: Missing Graphic Image]

. Review the summary page and click add to start connector creation. It generally takes about 10 mins to complete the deployment. Once completed, the connector instance apears in AWS EC2 dashboard.
+
image:snapctr_svcs_connector_10-review.png[Error: Missing Graphic Image]

. After the connector is deployed, login to the connector EC2 host as ec2-user with ssh key to install SnapCenter plugin following this instruction link:https://docs.netapp.com/us-en/cloud-manager-backup-restore/task-add-host-discover-oracle-databases.html#deploy-the-plug-in-using-script-and-add-host-from-ui-using-manual-option[Deploy the plug-in using script and add host from UI using manual option^]

====
=== SnapCenter services setup
[%collapsible]

====

With the connector deployed, now SnapCenter services can be setup with following procedures:

. From "My Working Environment" click on "Add working Environment" to discover FSx deployed in AWS
+
image:snapctr_svcs_setup_01.png[Error: Missing Graphic Image]

. Choose Amazon Web Services as Location.
+
image:snapctr_svcs_setup_02.png[Error: Missing Graphic Image]

. Click on "Discover Existing" Amazon FSx for ONTAP.
+
image:snapctr_svcs_setup_03.png[Error: Missing Graphic Image]

. Select the credentials that provides BlueXP with the permissions that it needs to manage FSx for ONTAP. If you have not added credential, you can add it from setting menu from top right corner of BlueXP console.
+
image:snapctr_svcs_setup_04.png[Error: Missing Graphic Image]

. Choose the AWS region where the FSx ONTAP is deployed, select the FSx cluster that is hosting the Oracle database and click Add.
+
image:snapctr_svcs_setup_05.png[Error: Missing Graphic Image]

. Discovered FSx ONTAP is now appearing in working environment.
+
image:snapctr_svcs_setup_06.png[Error: Missing Graphic Image]

. You can login to FSx cluster with your fsxadmin account credential.
+
image:snapctr_svcs_setup_07.png[Error: Missing Graphic Image]

. Once login to FSx ONTAP, you could review your database storage information such as database volumes. 
+
image:snapctr_svcs_setup_08.png[Error: Missing Graphic Image]

. From console left hand sidebar, hoover mouse to protection icon, then click on Protection - Applications to open Applications launch page and click on "Discover Applications".
+
image:snapctr_svcs_setup_09.png[Error: Missing Graphic Image]

. Select "Cloud Native" as the application source type.
+
image:snapctr_svcs_setup_10.png[Error: Missing Graphic Image]

. Choose Oracle for application type.
+
image:snapctr_svcs_setup_13.png[Error: Missing Graphic Image]

. Provide Oracle EC2 instance host details to add host, check the box to confirm the plugin for Oracle on the host has been installed as we have deployed the plugin after connector is provisioned.
+
image:snapctr_svcs_setup_16.png[Error: Missing Graphic Image]

. Oracle EC2 host should be discovered and added to Applications shortly and any databases on the host will be discovered and displaced on the page as well. The database "Protection Status" will show as "Unprotected".
+
image:snapctr_svcs_setup_17.png[Error: Missing Graphic Image]

This completes the SnapCenter services for Oracle initial setup. Move to next three sections for Oracle database backup, restore, and clone operation.

====

=== Oracle database backup
[%collapsible]

====

. Click on the three dots next to database "Protection Status", then "Polices" to view the default preloaded database protection policies that can be applied to protect your Oracle databases.
+
image:snapctr_svcs_bkup_01.png[Error: Missing Graphic Image]

. You could also create your own policy with customized backup frequency and backup data retention window.
+ 
image:snapctr_svcs_bkup_02.png[Error: Missing Graphic Image]

. Once you are happy with the policy configuration, you then assign policy of choice to protect the database.
+
image:snapctr_svcs_bkup_03.png[Error: Missing Graphic Image]

. Choose the policy to be assigned to database.
+
image:snapctr_svcs_bkup_04.png[Error: Missing Graphic Image]

. Once the policy is applied, the database protection status changed to "Protected" with a green check mark.
+
image:snapctr_svcs_bkup_05.png[Error: Missing Graphic Image]

. The database backup will run in a predefined schedule. You could also kick off one-off on-demand backup as show below.
+
image:snapctr_svcs_bkup_06.png[Error: Missing Graphic Image]

. The database backups details can be viewed by click on "View Details" from menu list. This includes backup name, backup type, SCN, backup date. A backup set covers a snapshot for both data volume and log volume. The log volume snapshot takes place right after database volume snapshot. A filter can be applied when the list grows long and you are looking for a particular backup.
+
image:snapctr_svcs_bkup_07.png[Error: Missing Graphic Image]

====

=== Oracle database restore and recovery
[%collapsible]

====

. For database restore, choose right backup either by SCN or backup time. Click on three dots from the database data backup, then restore to initiate a database restore and recovery. 
+
image:snapctr_svcs_restore_01.png[Error: Missing Graphic Image]

. Choose your restore setting. If you are sure there is nothing changed in terms of database physical structure such as add a data file, a disk group etc. after the backup, you can utilize "Force in place restore", which is generally faster. Otherwise, do not check the box.
+
image:snapctr_svcs_restore_02.png[Error: Missing Graphic Image]

. Review and start the DB restore and recovery.
+
image:snapctr_svcs_restore_03.png[Error: Missing Graphic Image]

. From "Job Monitoring" tab, you can view the status of restore job as well as the detail while it is running.
+
image:snapctr_svcs_restore_05.png[Error: Missing Graphic Image]
image:snapctr_svcs_restore_04.png[Error: Missing Graphic Image]

====

=== Oracle database clone 
[%collapsible]

====

To clone a database, launch the clone workflow from the same database backup details page.

. Select the right database backup copy, click on the three dots to view the menu and choose "Clone" option.
+
image:snapctr_svcs_clone_02.png[Error: Missing Graphic Image]

. Select "Basic" option, if you don't need to change the cloned database parameters. 
+
image:snapctr_svcs_clone_03.png[Error: Missing Graphic Image]

. Alternatively, select "Specification file", which you will have option to download current init file, make changes, and then upload back to the job.
+
image:snapctr_svcs_clone_03_1.png[Error: Missing Graphic Image]

. Review and launch the job.
+
image:snapctr_svcs_clone_04.png[Error: Missing Graphic Image]

. Monitor the clone job status from Job Monitoring tab.
+
image:snapctr_svcs_clone_07-status.png[Error: Missing Graphic Image]

. Validate the cloned database on the EC2 instance host. 
+
image:snapctr_svcs_clone_08-crs.png[Error: Missing Graphic Image]
image:snapctr_svcs_clone_08-db.png[Error: Missing Graphic Image]

====

== Additional information

To learn more about the information that is described in this document, review the following documents and/or websites:

* Set up and administer BlueXP
+
link:https://docs.netapp.com/us-en/cloud-manager-setup-admin/index.htmll[https://docs.netapp.com/us-en/cloud-manager-setup-admin/index.html^]

* Cloud Backup documentation
+
link:https://docs.netapp.com/us-en/cloud-manager-backup-restore/index.html[https://docs.netapp.com/us-en/cloud-manager-backup-restore/index.html^]

* Amazon FSx for NetApp ONTAP
+
link:https://aws.amazon.com/fsx/netapp-ontap/[https://aws.amazon.com/fsx/netapp-ontap/^]

* Amazon EC2
+
link:https://aws.amazon.com/pm/ec2/?trk=36c6da98-7b20-48fa-8225-4784bced9843&sc_channel=ps&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2&ef_id=Cj0KCQiA54KfBhCKARIsAJzSrdqwQrghn6I71jiWzSeaT9Uh1-vY-VfhJixF-xnv5rWwn2S7RqZOTQ0aAh7eEALw_wcB:G:s&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2[https://aws.amazon.com/pm/ec2/?trk=36c6da98-7b20-48fa-8225-4784bced9843&sc_channel=ps&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2&ef_id=Cj0KCQiA54KfBhCKARIsAJzSrdqwQrghn6I71jiWzSeaT9Uh1-vY-VfhJixF-xnv5rWwn2S7RqZOTQ0aAh7eEALw_wcB:G:s&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2^]


