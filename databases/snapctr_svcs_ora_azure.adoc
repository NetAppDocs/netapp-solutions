---
sidebar: sidebar
permalink: databases/snapctr_svcs_ora_azure.html
keywords: Oracle, Database, SnapCenter, SnapShot, FlexClone, BlueXP, Database Backup, Database Restore, Database Clone
summary: "The solution provides overview and details for Oracle database backup, restore, clone using NetApp SnapCenter SaaS using BlueXP console." 
---

= TR-4977: Oracle Database backup, restore and clone with SnapCenter Services - Azure
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./../media/

Allen Cao, Niyaz Mohamed, NetApp

[.lead]

== Purpose

SnapCenter Services is the SaaS version of the classic SnapCenter database management UI tool that is available through the NetApp BlueXP cloud management console. It is an integral part of the NetApp cloud-backup, data-protection offering for databases such as Oracle and HANA running on NetApp cloud storage. This SaaS-based service simplifies traditional SnapCenter standalone server deployment that generally requires a Windows server operating in a Windows domain environment.  

In this documentation, we demonstrate how you can set up SnapCenter Services to backup, restore, and clone Oracle databases deployed to Azure NetApp Files capacity pool storage and Azure compute instances. Although it is much easier to set up and use, SnapCenter Services deliver key functionalities that are available in the legacy SnapCenter UI tool.

This solution addresses the following use cases:

* Database backup with snapshots for Oracle databases hosted in Azure NetApp Files and Azure VMs
* Oracle database recovery in the case of a failure  
* Fast cloning of primary databases for a dev/test environment or other use cases  

== Audience

This solution is intended for the following audiences:

* The DBA who manages Oracle databases running on Azure NetApp Files storage
* The solution architect who is interested in testing Oracle database backup, restore, and clone in the public Azure cloud
* The storage administrator who supports and manages the Azure NetApp Files capacity storage pool
* The application owner who owns applications that are deployed to Azure NetApp Files storage and Azure VMs 

== Solution test and validation environment

The testing and validation of this solution was performed in an Azure NetApp Files and Azure VMs environment that might not match the final deployment environment. For more information, see the section <<Key Factors for Deployment Consideration>>.

=== Architecture

image::snapctr_svcs_architecture.png["This image provides a detailed picture of the Cloud Backup for Application within BlueXP console, including the UI, connector and resources it manages."]

This image provides a detailed picture of Cloud Backup for Application within the BlueXP console, including the UI, the connector, and the resources it manages.

=== Hardware and software components

[%autowidth.stretch]
|===
3+^| *Hardware*
| Azure NetApp Files storage | Current version offered by Azure | Premium Service level, Auto QoS type, and 4TB in storage capacity in testing
| Azure instance for compute | Standard B4ms (4 vcpus, 16 GiB memory) | Two instances deployed, one as primary DB server and the other as clone DB server 

3+^| *Software*
| RedHat Linux | Red Hat Enterprise Linux 8.7 (LVM) - x64 Gen2 | Deployed RedHat subscription for testing
| Oracle Database | Version 19.18 | Applied RU patch p34765931_190000_Linux-x86-64.zip
| Oracle OPatch | Version 12.2.0.1.36 | Latest patch p6880880_190000_Linux-x86-64.zip
| SnapCenter Service | Version v2.5.0-2822 |  Agent Version v2.5.0-2822
|===

=== Key factors for deployment consideration

* *Connector to be deployed in the same virtual network / subnet as databases and Azure NetApp Files.* When possible, the connector should be deployed in the same Azure virtual networks and resource groups, which enables connectivity to the Azure NetApp Files storage and the Azure compute instances.

* *An Azure user account or Active Directory service principle created at Azure portal for SnapCenter connector.* Deploying a BlueXP Connector requires specific permissions to create and configure a virtual machine and other compute resources, to configure networking, and to get access to the Azure subscription. It also requires permissions to later create roles and permissions for the Connector to operate. Create a custom role in Azure with permissions and assign to the user account or service principle. The policy in JSON format is available in the detailed SnapCenter service documentation. Or when you launch connector deployment within the BlueXP console, you are prompted to set up the prerequisites with the details of permission grants. 

* *A ssh key pair created in the Azure resource group.* The ssh key pair is assigned to the Azure VM user for logging into the connector host and also the database VM host for deploying and executing a plug-in. BlueXP console UI uses the ssh key to deploy SnapCenter service plugin to database host for one-step plugin installation and application host database discovery.

* *A credential added to the BlueXP console setting.* To add Azure NetApp Files storage to the BlueXP working environment, a credential that grants permissions to access Azure NetApp Files from the BlueXP console needs to be set up in the BlueXP console setting. 

* *java-11-openjdk installed on the Azure VM database instance host.* SnapCenter service installation requires java version 11. It needs to be installed before plugin deployment attempt. 

== Solution deployment

There is extensive NetApp documentation with a broader scope to help you protect your cloud-native application data. The goal of this documentation is to provide step-by-step procedures that cover SnapCenter Service deployment with the BlueXP console to protect your Oracle database deployed to Azure NetApp Files storage pool and an Azure compute instance. This document fills in certain details that might be missing from more general instructions.

To get started, complete the following steps:

* Read the general instructions link:https://docs.netapp.com/us-en/cloud-manager-backup-restore/concept-protect-cloud-app-data-to-cloud.html#architecture[Protect your cloud native applications data^] and the sections related to Oracle and Azure NetApp Files.
 

=== Prerequisites for SnapCenter service deployment
[%collapsible]

====
Deployment requires the following prerequisites.

. A primary Oracle database server on an Azure VM instance with an Oracle database fully deployed and running. 

. A Azure NetApp Files storage capacity pool deployed in Azure that has capacity to meet the database storage needs above.

. A secondary database server on an Azure VM instance that can be used for testing the cloning of an Oracle database to an alternative host for the purpose of supporting a dev/test workload or any use cases that requires a full data set of production Oracle database.

. If you need help to meet the above prerequisites for Oracle database deployment on Azure NetApp Files and Azure compute instance, see link:azure_ora_nfile_usercase.html[Oracle Database Deployment and Protection on Azure NetApp Files^].

====

=== Onboarding to BlueXP preparation
[%collapsible]

====

. Use the link link:https://console.bluexp.netapp.com/[NetApp BlueXP] to sign up for BlueXP console access.

. Create an Azure user account or an Active Directory service principle and grant permissions with role in Azure portal for Azure connector deployment.

. To set up BlueXP to manage Azure resources, add a BlueXP credential with details of an ID of an Active Directory service principal that BlueXP can use to authenticate with Azure Active Directory (App client ID), a client secret for the service principal application (Client Secret), and the Active Directory ID for your organization (Tenant ID).

. You also need the Azure virtual network, resources group, security group, an SSH key for VM access, etc. for connector provisioning and database plugin installation. 

====

=== Deploy a connector for SnapCenter services
[%collapsible]

====
. Log into the BlueXP console. BlueXP opens in Canvas and shows an empty working environment with exception of possible Blob storage of public cloud, which may be loaded by default. On the top of the page, you will see your account, workspace, and connector. The connector shows "N/A" as it has yet to be deployed. 
+
image:snapctr_svcs_connector_02-canvas.png["Screenshot showing this step in the GUI."]

. For a shared account, it is a best practice to create an individual workspace by clicking *Account* > *Manage Account* > *Workspace* to add a new workspace.
+ 
image:snapctr_svcs_connector_02-wspace.png["Screenshot showing this step in the GUI."]

. Click on Connector drop down arrow and *Add Connector* to launch the connector provisioning workflow.
+
image:snapctr_svcs_connector_03-addc.png["Screenshot showing this step in the GUI."]

. Choose your cloud provider (in this case, *Microsoft Azure*).
+
image:snapctr_svcs_connector_04-azure.png["Screenshot showing this step in the GUI."]

. Skip the *Permission*, *Authentication*, and *Networking* steps if you already have them set up in your Azure account. If not, you must configure these before proceeding. From here, you could also retrieve the permissions for the Azure policy that is referenced in the previous section "<<Onboarding to BlueXP preparation>>." 
+
image:snapctr_svcs_connector_05-azure.png["Screenshot showing this step in the GUI."]

. Click on "Skip to Deployment" to configure your connector "Virtual Machine Authentication".
+
image:snapctr_svcs_connector_06-azure.png["Screenshot showing this step in the GUI."]

. Name the connector instance, select *Create* and accept default *Role Name* under *Details*, and choose the subscription for the Azure account.
+
image:snapctr_svcs_connector_07-azure.png["Screenshot showing this step in the GUI."]

. Configure networking with the proper VNet, Subnet, and enable Public IP if needed.
+
image:snapctr_svcs_connector_08-azure.png["Screenshot showing this step in the GUI."]

. Configure the security group for the connector.
+
image:snapctr_svcs_connector_09-azure.png["Screenshot showing this step in the GUI."]

. Review the summary page and click *Add* to start connector creation. It generally takes about 10 mins to complete deployment. Once completed, the connector instance appears in the AWS EC2 dashboard.
+
image:snapctr_svcs_connector_10-azure.png["Screenshot showing this step in the GUI."]

. After the connector is deployed, the newly created connector will appear under Connector drop-down. 
+
image:snapctr_svcs_connector_11-azure.png["Screenshot showing this step in the GUI."]

====

=== Define a credential in BlueXP for Azure resources access
[%collapsible]

====
. Click on setting icon on top right corner of BlueXP console to open *Account credentials* page, click *Add credentials* to start credential configuration workflow.
+
image:snapctr_svcs_credential_01-azure.png["Screenshot showing this step in the GUI."]

. Choose credential location as - *Microsoft Azure - BlueXP*.
+
image:snapctr_svcs_credential_02-azure.png["Screenshot showing this step in the GUI."]

. Define Azure credentials with proper *Client Secret*, *Client ID*, and *Tenant ID*, which should have been gathered during previous BlueXP onboarding process.
+
image:snapctr_svcs_credential_03-azure.png["Screenshot showing this step in the GUI."]

. Review and Add.
image:snapctr_svcs_credential_04-azure.png["Screenshot showing this step in the GUI."]
====

=== SnapCenter services setup
[%collapsible]

====

With the credential configured, SnapCenter services can now be set up with the following procedure:

. Now back to Canvas page, from *My Working Environment* click *Add working Environment* to discover Azure NetApp Files deployed in Azure cloud.
+
image:snapctr_svcs_connector_11-azure.png["Screenshot showing this step in the GUI."]

. Choose *Microsoft Azure* as the location and click on *Discover*.
+
image:snapctr_svcs_setup_02-azure.png["Screenshot showing this step in the GUI."]

. Name *Working Environment* and choose *Credential Name* created in previous steps, and click *Continue*.
+
image:snapctr_svcs_setup_03-azure.png["Screenshot showing this step in the GUI."]

. BlueXP console returns to *My working environments* and discovered Azure NetApp Files from Azure cloud now appears on *Canvas*.
+
image:snapctr_svcs_setup_04-azure.png["Screenshot showing this step in the GUI."]

. Click on *Azure NetApp Files* icon, then *Enter Working Environment* to view Oracle database volumes provisioned in capacity pool storage.
+
image:snapctr_svcs_setup_05-azure.png["Screenshot showing this step in the GUI."]

. From the left-hand sidebar of the console, hover your mouse over the protection icon, and then click *Protection* > *Applications* to open the Applications launch page. Click *Discover Applications*.
+
image:snapctr_svcs_setup_09-azure.png["Screenshot showing this step in the GUI."]

. Select *Cloud Native* as the application source type.
+
image:snapctr_svcs_setup_10-azure.png["Screenshot showing this step in the GUI."]

. Choose *Oracle* for the application type, click on *Next* to open *Host Details* page.
+
image:snapctr_svcs_setup_13-azure.png["Screenshot showing this step in the GUI."]

. Select *Using SSH* and provide the Oracle Azure VM instance host details such as *IP address*, *Connector*, Azure VM management *Username* such as azureuser. Click on *Add SSH Private Key* to paste in the SSH key pair that you used to deploy the Oracle Azure VM instance. You will also be prompted to confirm the fingerprint.
+
image:snapctr_svcs_setup_15-azure.png["Screenshot showing this step in the GUI."]
image:snapctr_svcs_setup_16-azure.png["Screenshot showing this step in the GUI."]

. Move on to next *Configuration* page for sudoer access on Oracle database application host. 
+
image:snapctr_svcs_setup_17-azure.png["Screenshot showing this step in the GUI."]

. Review and click on *Discover Applications* to install a plugin on the Oracle database application host and discover Oracle database on the host.
+
image:snapctr_svcs_setup_18-azure.png["Screenshot showing this step in the GUI."]

. Discovered Oracle databases on Azure VM host are added to *Applications*, and the Applications page list the number of hosts and Oracle databases within the environment. The database *Protection Status* initially shows as *Unprotected*.
+
image:snapctr_svcs_setup_19-azure.png["Screenshot showing this step in the GUI."]

This completes the initial setup of SnapCenter services for Oracle. The next three sections of this document describe Oracle database backup, restore, and clone operations.

====

=== Oracle database backup
[%collapsible]

====

. Click the three dots next to the database *Protection Status*, and then click *Polices* to view the default preloaded database protection policies that can be applied to protect your Oracle databases.
+
image:snapctr_svcs_bkup_01.png["Screenshot showing this step in the GUI."]

. You can also create your own policy with a customized backup frequency and backup data-retention window.
+ 
image:snapctr_svcs_bkup_02.png["Screenshot showing this step in the GUI."]

. When you are happy with the policy configuration, you can then assign your policy of choice to protect the database.
+
image:snapctr_svcs_bkup_03.png["Screenshot showing this step in the GUI."]

. Choose the policy to assign to the database.
+
image:snapctr_svcs_bkup_04.png["Screenshot showing this step in the GUI."]

. After the policy is applied, the database protection status changed to *Protected* with a green check mark.
+
image:snapctr_svcs_bkup_05.png["Screenshot showing this step in the GUI."]

. The database backup runs on a predefined schedule. You can also run a one-off on-demand backup as shown below.
+
image:snapctr_svcs_bkup_06.png["Screenshot showing this step in the GUI."]

. The database backups details can be viewed by clicking *View Details* from the menu list. This includes the backup name, backup type, SCN, and backup date. A backup set covers a snapshot for both data volume and log volume. A log volume snapshot takes place right after a database volume snapshot. You can apply a filter if you are looking for a particular backup in a long list.
+
image:snapctr_svcs_bkup_07.png["Screenshot showing this step in the GUI."]

====

=== Oracle database restore and recovery
[%collapsible]

====

. For a database restore, choose the right backup, either by the SCN or backup time. Click the three dots from the database data backup, and then click *Restore* to initiate database restore and recovery. 
+
image:snapctr_svcs_restore_01.png["Screenshot showing this step in the GUI."]

. Choose your restore setting. If you are sure that nothing has changed in the physical database structure after the backup (such as the addition of a data file or a disk group), you can use the *Force in place restore* option, which is generally faster. Otherwise, do not check this box.
+
image:snapctr_svcs_restore_02.png["Screenshot showing this step in the GUI."]

. Review and start database restore and recovery.
+
image:snapctr_svcs_restore_03.png["Screenshot showing this step in the GUI."]

. From the *Job Monitoring* tab, you can view the status of the restore job as well as any details while it is running.
+
image:snapctr_svcs_restore_05.png["Screenshot showing this step in the GUI."]
+
image:snapctr_svcs_restore_04.png["Screenshot showing this step in the GUI."]

====

=== Oracle database clone 
[%collapsible]

====

To clone a database, launch the clone workflow from the same database backup details page.

. Select the right database backup copy, click the three dots to view the menu, and choose the *Clone* option.
+
image:snapctr_svcs_clone_02.png[Error: Missing Graphic Image]

. Select the *Basic* option if you don't need to change any cloned database parameters. 
+
image:snapctr_svcs_clone_03.png[Error: Missing Graphic Image]

. Alternatively, select *Specification file*, which gives you the option of downloading the current init file, making changes, and then uploading it back to the job.
+
image:snapctr_svcs_clone_03_1.png[Error: Missing Graphic Image]

. Review and launch the job.
+
image:snapctr_svcs_clone_04.png[Error: Missing Graphic Image]

. Monitor the cloning job status from the *Job Monitoring* tab.
+
image:snapctr_svcs_clone_07-status.png[Error: Missing Graphic Image]

. Validate the cloned database on the EC2 instance host. 
+
image:snapctr_svcs_clone_08-crs.png[Error: Missing Graphic Image]
+
image:snapctr_svcs_clone_08-db.png[Error: Missing Graphic Image]

====

== Additional information

To learn more about the information that is described in this document, review the following documents and/or websites:

* Set up and administer BlueXP
+
link:https://docs.netapp.com/us-en/cloud-manager-setup-admin/index.htmll[https://docs.netapp.com/us-en/cloud-manager-setup-admin/index.html^]

* Cloud Backup documentation
+
link:https://docs.netapp.com/us-en/cloud-manager-backup-restore/index.html[https://docs.netapp.com/us-en/cloud-manager-backup-restore/index.html^]

* Amazon FSx for NetApp ONTAP
+
link:https://aws.amazon.com/fsx/netapp-ontap/[https://aws.amazon.com/fsx/netapp-ontap/^]

* Amazon EC2
+
link:https://aws.amazon.com/pm/ec2/?trk=36c6da98-7b20-48fa-8225-4784bced9843&sc_channel=ps&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2&ef_id=Cj0KCQiA54KfBhCKARIsAJzSrdqwQrghn6I71jiWzSeaT9Uh1-vY-VfhJixF-xnv5rWwn2S7RqZOTQ0aAh7eEALw_wcB:G:s&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2[https://aws.amazon.com/pm/ec2/?trk=36c6da98-7b20-48fa-8225-4784bced9843&sc_channel=ps&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2&ef_id=Cj0KCQiA54KfBhCKARIsAJzSrdqwQrghn6I71jiWzSeaT9Uh1-vY-VfhJixF-xnv5rWwn2S7RqZOTQ0aAh7eEALw_wcB:G:s&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2^]


