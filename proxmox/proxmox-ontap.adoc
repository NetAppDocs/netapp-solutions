---
sidebar: sidebar
permalink: proxmox/proxmox-ontap.html
keywords: netapp, proxmox, proxmox ve, all-flash, nfs, iscsi, ontap, storage, aff
summary:
---

:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./../media/

== Proxmox VE with ONTAP
[.lead]
A shared storage in Proxmox Virtual Environment(VE) reduces the time for VM live migration, makes better target for backups and consistent template across the environment. ONTAP can serve the needs of Proxmox VE host environments as well as for the guest file, block or object storage demands.

Proxmox VE hosts need to have FC, Ethernet or other supported interfaces cabled to switches and have communication to ONTAP logical interfaces.

=== High-level ONTAP Features

**Common features**

* Secure Authentication and RBAC support
* Zero trust multi admin support
* Secure Multitenancy
* Replicate data with SnapMirror.
* Point in time copies with Snapshots.
* Storage efficiency features like dedupe, compression, etc.
* Trident CSI support for Kubernetes
* Snaplock
* Encryption support
* FabricPool to tier cold data to object store.
* BlueXP and CloudInsights Integration.

**NAS**

* FlexGroup volumes is a scale out NAS container to provide high performance along with load distribution and scalability.
* FlexCache allows data to be distributed globally and still provide local read and write access to the data.
* Multiprotocol support enables the same data to be access via SMB as well as on NFS.
* NFS nConnect allows multiple TCP sessions per TCP connection increasing network throughput 
to utilize high speed nics available on modern servers.
* NFS session trunking provides increasing data transfer speed, high availability and fault tolerance.
* SMB multichannel provides increasing data transfer speed, high availability and fault tolerance.
* Integration with Active directory/LDAP for file permissions.
* Secure connection with NFS over TLS. 
* NFS Kerberos support.
* NFS over RDMA.
* Name mapping between Windows and Unix identities.
* Autonomous ransomware protection
* File System Analytics

**SAN**

* Stretch cluster across fault domains with SnapMirror active sync.
* ASA models provide active/active multipathing and fast path failover.
* Support for FC, iSCSI, NVMe-oF protocols.
* Support for iSCSI CHAP mutual authentication


=== Proxmox VE storage types supported with ONTAP

NAS protocols (NFS/SMB) supports all content types of Proxmox VE and typically configured once at datacenter level. Block storage with SAN protocols (FC/iSCSI/NVMe-oF) are typically configured per host basis & restricted to VM Disk and Container Image content types of Proxmox VE.

|====
|Content Type| NFS | SMB/CIFS | FC | iSCSI | NVMe-oF
|Backups | Yes | Yes | No*| No* |No*
|VM Disks | Yes | Yes | Yes** | Yes** | Yes**
|CT Volumes | Yes | Yes | Yes** | Yes** | Yes**
|ISO Images | Yes | Yes | No*| No* |No*
|CT Templates | Yes | Yes | No*| No* |No*
|Snippets | Yes | Yes | No*| No* |No*
|====
/* Create a folder on cluster filesystem and use Directory storage type.
/** use LVM storage type

=== SMB/CIFS Storage 

To utilize SMB/CIFS file share, there are certain tasks that needs to be carried out by storage admin and virtualization admin can mount that share using Proxmox VE UI or from shell. SMB multichannel provides fault tolerance and boosts performance. For more details, refer https://www.netapp.com/pdf.html?item=/media/17136-tr4740.pdf[TR4740 - SMB 3.0 Multichannel]

NOTE: Password will be saved in clear text file and accessible only to root user. Refer https://pve.proxmox.com/pve-docs/chapter-pvesm.html#storage_cifs[Proxmox VE documentation]

**Storage Admin Tasks**

. Ensure SVM is enabled for SMB. Follow https://docs.netapp.com/us-en/ontap/smb-config/configure-access-svm-task.html[ONTAP 9 documentation] if need help.
. Have at least two lifs per controller. Follow the steps from the above link. For reference, here is the screenshot of lifs that we use in our lab. 
image:proxmox-ontap-image01.png[nas interface details]
. Use Active Directory or workgroup based authentication. Follow the steps from the above link.
image:proxmox-ontap-image02.png[Join domain info]
. Create a SMB share and adjust permissions. Follow https://docs.netapp.com/us-en/ontap/smb-config/configure-client-access-shared-storage-concept.html [ONTAP 9 documentation] if need assistance.
image:proxmox-ontap-image03.png[SMB share info]
. Provide the SMB server, Share name and credential to use for the share to virtualization admin.

**Virtualization Admin Tasks**

. Collect the SMB server, share name and credential to use for the share authentication.
. Ensure at least two interface is configured in different VLANs (for fault tolerance) and NIC supports RSS.
. If using Management UI (https://<proxmox node>:8006), click on datacenter, select storage, click Add and select SMB/CIFS.
image:proxmox-ontap-image04.png[SMB storage navigation]
. Fill in the details, the share name should auto populate. Ensure all content are selected. Click Add.
image:proxmox-ontap-image05.png[SMB storage addition]
. To enable multichannel option, goto shell on any one of the nodes on the cluster and type pvesm set pvesmb01 --options multichannel,max_channels=4
image:proxmox-ontap-image06.png[multichannel setup]
. Here is the content in /etc/pve/storage.cfg for the above tasks.
image:proxmox-ontap-image07.png[storage configuration file for SMB]
