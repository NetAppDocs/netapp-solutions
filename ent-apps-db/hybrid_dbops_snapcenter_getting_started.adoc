---
sidebar: sidebar
permalink: ent-apps-db/hybrid_dbops_snapcenter_getting_started.html
summary: hybrid cloud database solutions with SnapCenter getting started
keywords: netapp, solutions, database, SnapCenter, "getting started"
---

= Hybrid Cloud Database Workflow Getting Started
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:table-stripes: odd
:imagesdir: ./../media/

[.lead]
Certain prerequisites needs to be configured at both on-prem and cloud before any actual hybrid cloud database workload execution. Following provide a high level summary and the details of the prerequisites configuration can be drilled down as needed through the attached links.

== On Premises

=== 1. Setup Database Admin User in SnapCenter

NetApp SnapCenter tool utilizes role based access control (RBAC) for managing user access and permission grants. There are prepopulated roles after SnapCenter installation. Custom roles can be created as well based on user needs or applications. It makes sense to have a dedicated admin user ID for each database platform supported by SnapCenter for database backup and recovery, disaster recovery. Some may also choose to use a single ID to manage all databases. In our test cases, we have created an dedicated admin user for Oracle and SQL Server respectively.

In a pre installed and configured on-prem SnapCenter environment, following tasks may already have being done. If not, following are steps to create database admin user:

. Add the admin user to windows active directory
. Login to SnapCenter using a ID granted with SnapCenterAdmin role
. Go to Setting and Users and Access tab, click on Add button to add new user. The new user id will be linked to admin user created in windows active directory in step 1. Assign proper role to the user as needed. Assign resources to admin user as applicable.

image:snapctr_admin_users.PNG[Error: Missing Graphic Image]

=== 2. SnapCenter Plugin Installation Prerequisites

SnapCenter performs its backup, restore, clone etc. functions via a plugin agent running on DB hosts. It connects to database host and database via credential configured under Setting and Credentials tab for plugin istallation and other management functions. There are specific privileges requirements for Linux or Windows user based on target host and database type.

Generally, you want to use an administrator user accounts on the host as your host connection credentials for plugin installation. You can also grant the same user for database access using OS based authentication. On the other hand, you can also use different database user ID for DB management access. If you decided to use OS based authentication, the OS admin user ID must be granted DB access. For Windows domain based SQL Server installation, an domain admin account can be used to manage all SQL Server within the domain.

. Windows host for SQL server:
.. If you are using Windows credentials for authentication, you must set up your credential before installing plug-ins.
.. If you are using an SQL Server instance for authentication, you must add the credential after installing plug-ins.
.. If you have enabled SQL authentication while setting up the credentials, the discovered instance or database is shown with a red color lock icon. If the lock icon appears, you must specify the instance or database credentials to successfully add the instance or database to a resource group.
.. You must assign the credential to a role-based access control (RBAC) user without sysadmin access when the following conditions are met:
... The credential is assigned to an SQL instance.
... The SQL instance or host is assigned to an RBAC user.
... The RBAC DB admin user must have both the resource group and backup privileges.

. Unix host for Oracle:
.. You must have enabled the password-based SSH connection for the root or non-root user.
.. Configure the sudo privileges for the non-root user to install and start the plug-in process. After installing the plug-in, the processes will be running as an effective root user.
.. Create credentials with authentication mode as Linux for the install user.
.. You must have installed Java 1.8.x, 64-bit, on your Linux host.
.. Installation of Oracle database plugin will also install SnapCenter plugin for Unix.

=== 3. SnapCenter Host Plugin Installation

Following steps illustrate how a database host is added to SnapCenter while a SnapCenter plugin is installed on the host. The procedure applies to both adding on-prem hosts and adding cloud hosts. Following demonstrates adding a Windows host residing in AWS.

. Add Windows host and installation of plugin on the host:
.. Login to SnapCenter as an user ID with SnapCenterAdmin privilege
.. Click on Hosts tab from left side menu list, then click on Add to open add host workflow
.. Choose Windows for Host Type, Host Name can be either host name or IP address, however host name must be resolved to correct host IP address from SnapCenter host. Choose host credentials created in step 2. Choose Microsoft Windows and Microsoft SQL Server as the plugin packages to be installed
+
image:snapctr_add_windows_host_01.PNG[Error: Missing Graphic Image]

.. After plugin is installed on a Windows host, its Overall Status is showing as "Configure log directory".
+
image:snapctr_add_windows_host_02.PNG[Error: Missing Graphic Image]

.. Click on host Name to open SQL Server log directory configuration
+
image:snapctr_add_windows_host_03.PNG[Error: Missing Graphic Image]

.. Click on "Configure log directory" to open "Configure Plug-in for SQL Server"
+
image:snapctr_add_windows_host_04.PNG[Error: Missing Graphic Image]

.. Click on Browse to discover the NetApp storage that a log directory can be set. SnapCenter use this log directory to rollup the SQL server transaction log files, then click on Save.
+
image:snapctr_add_windows_host_05.PNG[Error: Missing Graphic Image]

.. After log directory is configured, the Windows host plugin Overall Status is changed to Running.
+
image:snapctr_add_windows_host_06.PNG[Error: Missing Graphic Image]

.. Assign the host to database management user ID - navigating to Settings and Users and Access tab, click on the user ID that the host needs to be assigned to, click Save to complete the host resource assignment
+
image:snapctr_add_windows_host_07.PNG[Error: Missing Graphic Image]
image:snapctr_add_windows_host_08.PNG[Error: Missing Graphic Image]

.. With successful installation, the database resources on the host can be immediately discovered. Click on resources tab discover the new resources on the host just enabled. Click on Refresh if resources are not discovered. If Windows credential does not have sysadmin access to database instance, additional database credential can be configured to unlock the red lock.
+
image:snapctr_add_windows_host_09.PNG[Error: Missing Graphic Image]
image:snapctr_add_windows_host_10.PNG[Error: Missing Graphic Image]

.. After appropriate credential is configured either at Windows level or database level, the SQL Server Type is reviewed.
+
image:snapctr_add_windows_host_11.PNG[Error: Missing Graphic Image]











=== 4. DB Resource Discovery

Once DB host plugin is installed, click on Resources tab on the left side menu. Then click on Refresh Resources tab. If the plugin is installed appropriately, the databases resources on the host should be discovered and displayed.

image:snapctr_resources_ora.PNG[Error: Missing Graphic Image]

When its initially discovered, the database Overall Status shows as "Not protected". The above screen shot an Oracle database not protected as yet by a backup policy.

When backup configuration or policy is setup and a backup has been executed, the database Overall Status will show the backup status such as "Backup succeeded" and timestamp of last backup. Below screen shot shows the backup status of a SQL Server user database.

image:snapctr_resources_sql.PNG[Error: Missing Graphic Image]

=== 5. Setup Storage Cluster Peering and DB Volumes Replication



=== 6. Using Ansible Automation to Sync Up DB Instances between On-prem and Cloud - Optional



== Public Cloud

[NOTE]
To make things easier to follow, we have created this document based on a deployment in AWS, however the process is very similar in Azure and GCP too.

=== Pre-flight check

Before deploying anything, ensure that the infrastructure is in place to allow for the deployment in the next stage. This includes:

[%interactive]
* [ ] AWS account
* [ ] VPC in your region of choice
* [ ] Subnet with access to the public internet
* [ ] Permissions to add IAM roles into your AWS account
* [ ] A secret key and access key for your AWS user

=== Steps to deploy Cloud Manager and Cloud Volumes ONTAP in AWS

[NOTE]
There are many methods for deploying Cloud Manager and Cloud Volumes ONTAP, this method is the simplest but requires the most permissions. If this method is not appropriate for your AWS environment, please consult the https://docs.netapp.com/us-en/occm/task_creating_connectors_aws.html[NetApp Cloud Documentation^].

==== Deploy the Cloud Manager connector

. Navigate to https://cloudmanager.cloud.netapp.com[NetApp Cloud Central^] and login or sign up.
image:cloud_central_login_page.PNG[Error: Missing Graphic Image]
. Once you have logged in, you should be taken to the Canvas
image:cloud_central_canvas_page.PNG[Error: Missing Graphic Image]
. Click on "Add Working Environment" and choose Cloud Volumes ONTAP in AWS. Here, you will also choose whether you want to deploy a single node system or a high availability pair. I will choose to deploy a high availability pair.
image:cloud_central_add_we.PNG[Error: Missing Graphic Image]
. If no connector has been created, a pop up will appear that asks you to create a connector
image:cloud_central_add_conn_1.PNG[Error: Missing Graphic Image]
. Click Lets Start and then choose AWS
image:cloud_central_add_conn_3.PNG[Error: Missing Graphic Image]
. Enter your secret key and access key - ensure that your user has the correct permissions outlined on the https://mysupport.netapp.com/site/info/cloud-manager-policies[NetApp policies page^]
image:cloud_central_add_conn_4.PNG[Error: Missing Graphic Image]
. Give the connector a name and either use a pre-defined role as described on the https://mysupport.netapp.com/site/info/cloud-manager-policies[NetApp policies page^] or ask Cloud Manager to create the role for you
image:cloud_central_add_conn_5.PNG[Error: Missing Graphic Image]
. Give the networking information of where to deploy the connector. Ensure that outbound internet access is enabled by:
.. Giving the connector a public IP address
.. Giving the connector a proxy to work through
.. Giving the connector a route to the public internet through an Internet Gateway
image:cloud_central_add_conn_6.PNG[Error: Missing Graphic Image]
. Ensure communication with the connector via ssh, http and https by either providing a security group or creating a new security group. I have enabled access to the connector from my IP address only.
image:cloud_central_add_conn_7.PNG[Error: Missing Graphic Image]
. Review the information on the summary page and click Add to deploy the connector
image:cloud_central_add_conn_8.PNG[Error: Missing Graphic Image]
. The connector will now deploy using a cloud formation stack. You can monitor its progress from Cloud Manager or through AWS.
image:cloud_central_add_conn_9.PNG[Error: Missing Graphic Image]
. When the deployment is complete, a success page will appear.
image:cloud_central_add_conn_10.PNG[Error: Missing Graphic Image]

==== Deploy Cloud Volumes ONTAP

. Select AWS and the type of deployment based on your requirements.
image:cloud_central_add_we_1.PNG[Error: Missing Graphic Image]
. If no subscription has been assigned and you wish to purchase with PAYGO, choose Edit Credentials
image:cloud_central_add_we_2.PNG[Error: Missing Graphic Image]
. Choose Add Subscription
image:cloud_central_add_we_3.PNG[Error: Missing Graphic Image]
. Choose the type of contract that you wish to subscribe to. I chose Pay-as-you-go.
image:cloud_central_add_we_4.PNG[Error: Missing Graphic Image]
. You will be redirected to AWS - choose Continue to Subscribe
image:cloud_central_add_we_5.PNG[Error: Missing Graphic Image]
. Subscribe and you will be redirected back to NetApp Cloud Central. If you have already subscribed and don't get redirected, choose the "click here" link.
image:cloud_central_add_we_6.PNG[Error: Missing Graphic Image]
. You will be redirected to Cloud Central where you will need to name your subscription and assign it to your Cloud Central account.
image:cloud_central_add_we_7.PNG[Error: Missing Graphic Image]
. When successful, you will have a check mark page appear. Navigate back to your Cloud Manager tab.
image:cloud_central_add_we_8.PNG[Error: Missing Graphic Image]
. The subscription will now appear in Cloud Central. Click Apply to continue.
image:cloud_central_add_we_9.PNG[Error: Missing Graphic Image]
. Enter the working environment details such as:
.. Cluster name
.. Cluster password
.. AWS tags (Optional)
image:cloud_central_add_we_10.PNG[Error: Missing Graphic Image]
. Choose which additional services you would like to deploy. To discover more about these services, visit the https://cloud.netapp.com[NetApp Cloud Homepage^].
image:cloud_central_add_we_11.PNG[Error: Missing Graphic Image]
. Choose whether to deploy in multiple availability zones (reguires 3 subnets, each in a different AZ), or a single availability zone. I chose multiple AZs.
image:cloud_central_add_we_12.PNG[Error: Missing Graphic Image]
. Choose the region, VPC and security group for the cluster to be deployed into. In this section, you will also assign the availability zones per node (and mediator) as well as the subnets that they occupy.
image:cloud_central_add_we_13.PNG[Error: Missing Graphic Image]
. Choose the connection methods for the nodes as well as the mediator.
image:cloud_central_add_we_14.PNG[Error: Missing Graphic Image]
[TIP]
The mediator will require communication with the AWS APIs. A public IP address is not required so long as the APIs are reachable once the mediator EC2 instance has been deployed.
. Floating IP addresses are used to allow access to the various IP addresses that Cloud Volumes ONTAP uses including cluster management and data serving IPs. These will need to be addresses that are not already routable within your network and are added to route tables in your AWS environment. These are required to enable consistent IP addresses for an HA pair during failover. More information about floating IP addresses can be found in the https://docs.netapp.com/us-en/occm/reference_networking_aws.html#requirements-for-ha-pairs-in-multiple-azs[NetApp Cloud Documenation^].
image:cloud_central_add_we_15.PNG[Error: Missing Graphic Image]
. Select which route tables the floating IP addresses will be added to. These route tables will be used by clients to communicate with Cloud Volumes ONTAP.
image:cloud_central_add_we_16.PNG[Error: Missing Graphic Image]
. Choose whether to enable AWS managed encryption or AWS KMS to encrypt ONTAP's root, boot and data disks.
image:cloud_central_add_we_17.PNG[Error: Missing Graphic Image]
. Choose your licensing model. If you don't know which to choose, please contact your NetApp representative.
image:cloud_central_add_we_18.PNG[Error: Missing Graphic Image]
. Select which configuration best suits your use case. This will be related to the sizing considerations covered in the prerequisites page.
image:cloud_central_add_we_19.PNG[Error: Missing Graphic Image]
. Optionally create a volume. This is not required, as the next steps involve using snapmirror which will create the volumes for us.
image:cloud_central_add_we_20.PNG[Error: Missing Graphic Image]
. Review the selections made and tick the boxes to ensure that you understand that Cloud Manager will deploy resources into your AWS environment. When ready, click Go.
image:cloud_central_add_we_21.PNG[Error: Missing Graphic Image]
. Cloud Volumes ONTAP will now start its deployment process. Cloud Manager uses AWS APIs and cloud formation stacks to deploy Cloud Volumes ONTAP. It then configures the system to your specifications, giving you a ready-to-go system that can be instantly utilized. The timing for this process will vary depending on the selections made.
image:cloud_central_add_we_22.PNG[Error: Missing Graphic Image]
. You can monitor the progress by navigating to the Timeline.
image:cloud_central_add_we_23.PNG[Error: Missing Graphic Image]
. The Timeline acts as an audit of all actions performed in Cloud Manager. You can view all of the API calls that are made by Cloud Manager during setup to both AWS as well as the ONTAP cluster. This can also be effeftively used to troubleshoot any issues that you face.
image:cloud_central_add_we_24.PNG[Error: Missing Graphic Image]
. Once the deployment is complete, the CVO cluster will appear on the canvas and show the current capacity. The ONTAP cluster in its current state is fully configured to allow a true "out of the box" experience.
image:cloud_central_add_we_25.PNG[Error: Missing Graphic Image]
