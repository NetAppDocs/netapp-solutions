---
sidebar: sidebar
permalink: virtualization/vmware_vcf_aff_principal_vvols.html
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, vvol, vvols, array, ontap tools, otv, sddc
summary:
---

:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./../media/

[.lead]
Author: Ravi BCB, Josh Powell

== vVol datastore as principal storage for VI Workload Domains

=== Scenario Overview
In this scenario we will demonstrate how to configure a vVols datastore as principal storage for the deployment of a VI Workload Domain in VCF. A vVols container must be prepared in advance of deploying the Workload Domain. To do this ONTAP tools for VMware vSphere is installed in the VCF Management Domain and the Swagger API tool is used to create the vVols container.

Where appropriate we will refer to external documentation for the steps that must be performed in VCF's SDDC Manager, and only cover those steps that are specific to the storage configuration portion.

For more information on using vVols storage with VCF refer to link:https://docs.vmware.com/en/VMware-Cloud-Foundation/5.1/vcf-admin/GUID-28A95C3D-1344-4579-A562-BEE5D07AAD2F.html[vVols Storage with VMware Cloud Foundation]. 

For information on using ONTAP tools in VCF mode refer to link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/deploy/vmware_cloud_foundation_mode_deployment.html[VMware Cloud Foundation mode of deployment for ONTAP tools].  

This scenario covers the following high level steps:

* Verify networking for the ONTAP storage virtual machine (SVM) and that a logical interface (LIF), is present to carry NFS traffic.
* Create an export policy to allow the ESXi hosts access to the NFS volume.
* Deploy ONTAP tools for VMware vSphere (VCF mode) in the VCF Management Domain.
* Use the swagger API in ONTAP tools to………………
* Create a Network Pool for NFS and vMotion traffic in SDDC Manager.
* During VI Workload Domain deployment configuration, specify the information to connect to the NFS volume.
* Monitor the storage validation and workload domain deployment.
* Verify that the NFS datastore was created.

=== Prerequisites
This scenario requires the following components and configurations:

* NetApp AFF storage system with a storage virtual machine (SVM) configured to allow NFS traffic.
* Logical interface (LIF) has been created on the IP network that is to carry NFS traffic and is associated with the SVM.
* VCF management domain deployment is complete and the SDDC Manager interface is accessible.
* 4 x ESXi hosts commissioned within SDDC Manager and ready for Workload Domain deployment.
* IP addresses reserved for NFS storage traffic on the VLAN or network segment established for this purpose.

[NOTE]
When deploying a VI Workload Domain, VCF validates connectivity to the NFS Server. This is done using the management adapter on the ESXi hosts before any additional vmkernel adapter is added with the NFS IP address. Therefore, it is necessary to ensure that either 1) the management network is routable to the NFS Server, or 2) a LIF for the management network has been added to the SVM hosting the NFS datastore volume, to ensure that the validation can proceed.

For information on configuring ONTAP storage systems refer to the link:https://docs.netapp.com/us-en/ontap[ONTAP 9 Documentation] center.

For information on configuring VCF refer to link:https://docs.vmware.com/en/VMware-Cloud-Foundation/index.html[VMware Cloud Foundation Documentation].

=== Deployment Steps
To deploy a VI Workload Domain with a vVols datastore as principal storage, complete the following steps:

.Deploy ONTAP tools for VMware vSphere
[%collapsible]
==== 
ONTAP tools for VMware vSphere (OTV) is deployed as a VM appliance and provides an integrated vCenter UI for managing ONTAP storage. In this solution OTV is deployed in VCF mode which does not automatically register the plugin with vCenter and provides a swagger API interface to create the vVols container. 

Complete the following steps to Deploy ONTAP tools for VMware vSphere:

. Obtain the ONTAP tools OVA image from the link:https://mysupport.netapp.com/site/products/all/details/otv/downloads-tab[NetApp Support site] and download to a local folder.

. Log into the vCenter appliance for the VCF Management Domain.

. From the vCenter appliance interface right-click on the management cluster and select *Deploy OVF Template…*
+
image:vmware-vcf-aff-image21.png[Deploy OVF Template...]

. In the *Deploy OVF Template* wizard click the *Local file* radio button and select the ONTAP tools OVA file downloaded in the previous step.
+
image:vmware-vcf-aff-image22.png[Select OVA file]

. For steps 2 through 5 of the wizard select a name and folder for the VM, select the compute resource, review the details, and accept the license agreement.

. For the storage location of the configuration and disk files, select the vSAN datastore of the VCF Management Domain cluster.
+
image:vmware-vcf-aff-image23.png[Select OVA file]

. On the Select network page select the network used for management traffic.
+
image:vmware-vcf-aff-image24.png[Select network]

. On the Customize template page fill out all required information:
* Password to be used for administrative access to OTV.
* NTP server IP address.
* OTV maintenance account password.
* OTV Derby DB password.
* Check the box to *Enable VMware Cloud Foundation (VCF)*.
* FQDN or IP address of the vCenter appliance and provide credentials for vCenter.
* Provide the required network properties fields.

Click Next  to continue.

image:vmware-vcf-aff-image25.png[Customize OTV template 1]

image:vmware-vcf-aff-image26.png[Customize OTV template 2]

9. Review all information on the Ready to complete  page and the click Finish to begin deploying the OTV appliance.
====








