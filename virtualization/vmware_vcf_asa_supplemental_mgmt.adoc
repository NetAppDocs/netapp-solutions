---
sidebar: sidebar
permalink: virtualization/vmware_vcf_asa_supplemental.html
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, vvol, vvols, array, ontap tools, otv, sddc
summary:
---

:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./../media/

[.lead]
Author: Josh Powell

== Use ONTAP Tools to configure principal storage on VCF Management Domains

=== Scenario Overview
In this scenario we will demonstrate how to deploy and use ONTAP Tools for VMware vSphere (OTV) to configure an iSCSI datastore for a VCF Management Domain.

This scenario covers the following high level steps:

* Verify networking for the ONTAP storage virtual machine (SVM) and that a logical interface (LIF), is present to carry iSCSI traffic.
* Create an iGroup to allow the ESXi hosts access to the iSCSI LUN.
* Create an iSCSI LUN on the ONTAP storage system.
* Create 
* Create vmkernel adapters on the VCF Management Domain ESXi hosts for iSCSI.
* Deploy ONTAP Tools in the VCF Management Domain.
* Create a new VMFS datastore for the VCF Management Domain.


=== Prerequisites
This scenario requires the following components and configurations:

* NetApp ASA storage system with a storage virtual machine (SVM) configured to allow iSCSI traffic.
* Logical interface (LIF) has been created on the IP network that is to carry NFS traffic and is associated with the SVM.
* VCF management domain deployment is complete and the SDDC Manager interface is accessible.
* 4 x ESXi hosts configured for communication on the VCF management network.
* IP addresses reserved for vMotion and NFS storage traffic on the VLAN or network segment established for this purpose.

[NOTE]
When deploying a VI Workload Domain, VCF validates connectivity to the NFS Server. This is done using the management adapter on the ESXi hosts before any additional vmkernel adapter is added with the NFS IP address. Therefore, it is necessary to ensure that either 1) the management network is routable to the NFS Server, or 2) a LIF for the management network has been added to the SVM hosting the NFS datastore volume, to ensure that the validation can proceed.

For information on configuring ONTAP storage systems refer to the link:https://docs.netapp.com/us-en/ontap[ONTAP 9 Documentation] center.

For information on configuring VCF refer to link:https://docs.vmware.com/en/VMware-Cloud-Foundation/index.html[VMware Cloud Foundation Documentation].

=== Deployment Steps
To deploy a VI Workload Domain with an NFS datastore as principal storage, complete the following steps:

.Verify networking for ONTAP SVM
[%collapsible]
==== 
Verify that the required logical interfaces have been established for the network that will carry NFS traffic between the ONTAP storage cluster and VI Workload Domain.

. From ONTAP System Manager navigate to *Storage VMs* in the lefthand menu and click on the SVM to be used for NFS traffic. On the *Overview* tab, under *NETWORK IP INTERFACES*, click on the numeric to the right of *NFS*. In the list verify that the required LIF IP addresses are listed.
+
image:vmware-vcf-aff-image03.png[Verify LIFs for SVM]

Alternately, verify the LIFs associated with an SVM from the ONTAP CLI with the following command:

[source, cli]
network interface show -vserver <SVM_NAME>

. Verify that the ESXi hosts can communicate to the ONTAP NFS Server. Log into the ESXi host via SSH and ping the SVM LIF:

[source, cli]
vmkping <IP Address>

[NOTE]
When deploying a VI Workload Domain, VCF validates connectivity to the NFS Server. This is done using the management adapter on the ESXi hosts before any additional vmkernel adapter is added with the NFS IP address. Therefore, it is necessary to ensure that either 1) the management network is routable to the NFS Server, or 2) a LIF for the management network has been added to the SVM hosting the NFS datastore volume, to ensure that the validation can proceed.
====