---
sidebar: sidebar
permalink: virtualization/vmware_vcf_asa_scv_wkld.html
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, vvol, vvols, array, ontap tools, otv, sddc, scv, snapcenter, plug-in
summary:
---

:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./../media/

[.lead]
Author: Josh Powell

== Use SnapCenter Plug-in for VMware vSphere to protect VMs on VCF Workload Domains

=== Scenario Overview
In this scenario we will demonstrate how to deploy and use the SnapCenter Plug-in for VMware vSphere (SCV) to backup and restore VM's and datastores on a VCF Workload Domain. SCV uses ONTAP snapshot technology to take fast and efficient backup copies of the ONTAP storage volumes hosting vSphere datastores. SnapMirror and SnapVault technology are used to create secondary backups on a separate storage system and with retention policies that mimic the original volume or can be independent of the original volume for longer term retention.

*iSCSI* is used as the storage protocol for the VMFS datastore in this solution.

This scenario covers the following high level steps:

* Deploy the SnapCenter Plug-in for VMware vSphere (SCV) on the VI Workload Domain.
* Add storage systems to SCV.
* Create backup policies in SCV.
* Create Resource Groups in SCV.
* Use SCV to backup datastores or specific VMs.
* Use SCV to restores VMs to an alternate location in the cluster.
* Use SCV to restores files to a windows file system.

=== Prerequisites
This scenario requires the following components and configurations:

* An ONTAP ASA storage system with iSCSI VMFS datastores allocated to the Workload Domain cluster.
* A secondary ONTAP storage system configured to received secondary backups using SnapMirror.
* VCF Management Domain deployment is complete and the vSphere client is accessible.
* A VI Workload Domain has been previously deployed.
* Virtual machines are present on the cluster SCV is designated to protect.

For information on configuring iSCSI VMFS datastores as supplemental storage refer to Link:https://linkgoeshere.com[*iSCSI as supplemental storage for Management Domains*] in this documentation. The process for using OTV to deploy datastores is identical for Management and Workload Domains.


TIP: In addition to replicating backups taken with SCV to secondary storage, offsite copies of data can be made to object storage on one of the three (3) leading cloud providers using NetApp BlueXP backup and recovery for VMs. For more information refer to the solution link:https://docs.netapp.com/us-en/netapp-solutions/ehc/bxp-scv-hybrid-solution.html[3-2-1 Data Protection for VMware with SnapCenter Plug-in and BlueXP backup and recovery for VMs].





=== Deployment Steps
To deploy the SnapCenter Plug-in and use it to create backup and restore VMs and datastores, complete the following steps:

==== Deploy and use SCV to protect data in a VI Workload Domain
Complete the following steps to deploy, configure, and use SCV to protect data in a VI Workload Domain:

.Deploy the SnapCenter Plug-in for VMware vSphere
[%collapsible]
==== 
The SnapCenter Plug-in is installed on the VCF Management Domain but registered to the vCenter for the VI Workload Domain.

Complete the following steps from the vCenter client to deploy SCV to the VI Workload Domain:

. Download the OVA file for the SCV deployment from the download area of the NetApp support site link:https://mysupport.netapp.com/site/products/all/details/scv/downloads-tab[*HERE*].

. From the Management Domain vCenter Client, select to *Deploy OVF Template...*.
+
image:vmware-vcf-asa-image46.png[Deploy OVF Template...]
+
{nbsp}
. In the *Deploy OVF Template* wizard, click on the *Local file* radio button and then select to upload the previously downloaded OVF template. Click on *Next* to continue.
+
image:vmware-vcf-asa-image47.png[Select OVF template]
+
{nbsp}
. On the *Select name and folder* page, provide a name for the SCV data broker VM and a folder on the Management Domain. Click on *Next* to continue.

. On the *Select a compute resource* page, select the Management Domain cluster or specific ESXi host within the cluster to install the VM to.

. Review information pertaining to the OVF template on the *Review details* page and agree to the licensing terms on the *Licensing agreements* page. 

. On the *Select storage* page choose the datastore which the VM will be installed to and select the *virtual disk format* and *VM Storage Policy*. In this solution, the VM will be installed on an iSCSI VMFS datastore located on an ONTAP storage system, as previously deployed in a separate section of this documentation. Click on *Next* to continue.
+
image:vmware-vcf-asa-image48.png[Select OVF template]
+
{nbsp}
. On the *Select network* page, select the management network that is able to communicate with the Workload Domain vCenter appliance and both the primary and secondary ONTAP storage systems.
+
image:vmware-vcf-asa-image49.png[select management network]
+
{nbsp}
. On the *Customize template* page fill out all information required for the deployment:

* FQDN or IP, and credentials for the Workload Domain vCenter appliance.
* Credentials for the SCV administrative account.
* Credentials for the SCV maintenance account.
* IPv4 Network Properties details (IPv6 can also be used).
* Date and Time settings.
+
Click on *Next* to continue.
+
image:vmware-vcf-asa-image50.png[select management network]
+
image:vmware-vcf-asa-image51.png[select management network]
+
image:vmware-vcf-asa-image52.png[select management network]
+
{nbsp}

. Finally, on the *Ready to complete page*, review all settings and click on Finish to start the deployment.
====

.Add Storage Systems to SCV
[%collapsible]
==== 
Once the SnapCenter Plug-in is installed complete the following steps to add storage systems to SCV:

. SCV can be accessed from the main menu in the vSphere Client.
+
image:vmware-vcf-asa-image53.png[Open SnapCenter Plug-in]
+
{nbsp}
. At the top of the SCV UI interface, select the correct SCV instance that matches the vSphere cluster to be protected.
+
image:vmware-vcf-asa-image54.png[Select correct instance]
+
{nbsp}
. Navigate to *Storage Systems* in the left-hand menu and click on *Add* to get started.
+
image:vmware-vcf-asa-image55.png[Add new storage system]
+
{nbsp}
. On the *Add Storage System* form, fill in the IP address and credentials of the ONTAP storage system to be added, and click on *Add* to complete the action.
+
image:vmware-vcf-asa-image56.png[Provide storage system credentials]
+
{nbsp}
. Repeat this procedure for any additional storage systems to be managed, including any systems to be used as secondary backup targets.
====

.Configure backup policies in SCV
[%collapsible]
==== 
For more information on creating SCV backup policies refer to link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/scpivs44_create_backup_policies_for_vms_and_datastores.html[Create backup policies for VMs and datastores].

Complete the following steps to create a new backup policy:

. From the left-hand menu select *Policies* and click on *Create* to begin.
+
image:vmware-vcf-asa-image57.png[Create new policy]
+
{nbsp}
. On the *New Backup Policy* form, provide a *Name* and *Description* for the policy, the *Frequency* at which the backups will take place, and the *Retention* period which specifies how long the backup is retained. 
+
*Locking Period* enables the ONTAP SnapLock feature to create tamper proof snapshots and allows configuration of the locking period.
+
For *Replication* Select to update the underlying SnapMirror or SnapVault relationships for the ONTAP storage volume.  
+
TIP: SnapMirror and SnapVault replication are similar in that they both utilize ONTAP SnapMirror technology to asynchronously replicate storage volumes to a secondary storage system for increased protection and security. For SnapMirror relationships, the retention schedule specified in the SCV backup policy will govern retention for both the primary and secondary volume. With SnapVault relationships, a separate retention schedule can be established on the secondary storage system for longer term or differing retention schedules. In this case the snapshot label is specified in the SCV backup policy and in the policy associated with the secondary volume, to identify which volumes to apply the independent retention schedule to. 
+
Choose any additional advanced options and click on *Add* to create the policy.
+
image:vmware-vcf-asa-image58.png[Fill out policy details]
====

.Create resource groups in SCV
[%collapsible]
==== 
For more information on creating SCV Resource Groups refer to link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/scpivs44_create_resource_groups_for_vms_and_datastores.html[Create resource groups].

Complete the following steps to create a new resource group:

. From the left-hand menu select *Resource Groups* and click on *Create* to begin.
+
image:vmware-vcf-asa-image59.png[Create new resource group]
+
{nbsp}
. On the *General info & notification* page, provide a name for for the resource group, notification settings, and any additional options for the naming of the snapshots.

. On the *Resource* page select the datastores and VM's to be protected in the resource group. Click on *Next* to continue.
+
TIP: Even when only specific VMs are selected, the entire datastore is always backed up. This is because ONTAP takes snapshots of the volume hosting the datastore. However, note that selecting only specific VMs for backup limits the ability to restore to only those VMs.
+
image:vmware-vcf-asa-image60.png[Select resources to backup]
+
{nbsp}
. On the *Spanning disks* page select the option for how to handle VMs with VMDK's that span multiple datastores. Click on *Next* to continue.
+
image:vmware-vcf-asa-image61.png[Select spanning datastores option]
+
{nbsp}
. On the *Policies* page select a previously created policy or multiple policies that will be used with this resource group.  Click on *Next* to continue.
+
image:vmware-vcf-asa-image62.png[Select policies]
+
{nbsp}
. On the *Schedules* page establish for when the backup will run by configuring the recurrence and time of day. Click on *Next* to continue.
+
image:vmware-vcf-asa-image63.png[Select schedule ]
+
{nbsp}
. Finally review the *Summary* and click on *Finish* to create the resource group. 
+
image:vmware-vcf-asa-image64.png[Review summary and create resource group ]
+
{nbsp}
. With the resource group created click on the *Run Now* button to run the first backup.
+
image:vmware-vcf-asa-image65.png[Review summary and create resource group]
+
{nbsp}
. Navigate to the *Dashboard* and, under *Recent Job Activities* click on the number next to *Job ID* to open the job monitor and view the progress of the running job.
+
image:vmware-vcf-asa-image66.png[View backup job progress]
====

.Create resource groups in SCV
[%collapsible]
==== 
For more information on creating SCV Resource Groups refer to link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/scpivs44_create_resource_groups_for_vms_and_datastores.html[Create resource groups].

Complete the following steps to create a new resource group:

. From the left-hand menu select *Resource Groups* and click on *Create* to begin.
+
image:vmware-vcf-asa-image59.png[Create new resource group]
+
{nbsp}

==== Use SCV to restore VMs in a VI Workload Domain
The SnapCenter Plug-in allows restores of VMs, VMDKs, files, and folders from primary or secondary backups.

VMs can be restored to the original host, or to an alternate host in the same vCenter Server, or to an alternate ESXi host managed by the same vCenter or any vCenter in linked mode.

vVol VMs can be restored to the original host.

VMDKs in traditional VMs can be restored to either the original or to an alternate datastore.

VMDKs in vVol VMs can be restored to the original datastore.

Individual files and folders in a guest file restore session can be restored, which attaches a backup copy of a virtual disk and then restores the selected files or folders.

Complete the following steps to restore VMs, VMDKs or individual folders.


.Restore VMs with SCV
[%collapsible]
==== 
Complete the following steps to restore a VM with SCV:

. 
====

.Restore VMDKs with SCV
[%collapsible]
==== 
Complete the following steps to restore a VM with SCV:

. 
====

.Restore files and folders with SCV
[%collapsible]
==== 
Complete the following steps to restore a VM with SCV:

. 
====

For additional information:

For information on configuring ONTAP storage systems refer to the link:https://docs.netapp.com/us-en/ontap[ONTAP 9 Documentation] center.

For information on configuring VCF refer to link:https://docs.vmware.com/en/VMware-Cloud-Foundation/index.html[VMware Cloud Foundation Documentation].